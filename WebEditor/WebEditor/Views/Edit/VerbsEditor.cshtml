@model WebEditor.Models.Verbs
@using AxeSoftware.Quest;

<div class="ui-widget-header ui-corner-all toolbar">
    <button type="button" class="verbs-add">Add</button>
    <button type="button" class="verbs-delete">Delete</button>
</div>

@foreach (IEditorAttributeData attr in Model.EditorData.GetAttributeData().Where(a => !a.IsInherited))
{
    // Note: for now, we are excluding any inherited attributes. If we want to support these in future,
    // we will need to mark them as being inherited (e.g. display them in grey like the desktop editor),
    // and any scripts will need to copied before editing.

    object value = Model.EditorData.GetAttribute(attr.AttributeName);
    
    if (CanDisplayAttribute(attr.AttributeName, value))
    {
        string stringValue = value as string;
        IEditableScripts scriptValue = value as IEditableScripts;
        
        List<SelectListItem> typesList = new List<SelectListItem>
        {
            new SelectListItem { Text = "Print a message", Value = "string", Selected = (stringValue != null) },
            new SelectListItem { Text = "Run a script", Value = "script", Selected = (scriptValue != null) }
        };

        <div>
            @Html.CheckBox("verbs-select-" + attr.AttributeName, new { @class = "verbs-select" })
            @attr.AttributeName
            @Html.DropDownList("verbs-type-" + attr.AttributeName, typesList)
            <br />
            @if (scriptValue != null)
            {
                <div class="verbChild">
                @Html.Action("EditScriptValue", new { id = Model.GameId, key = Model.Key, script = scriptValue, attribute = attr.AttributeName })
                </div>
            }
            else
            {
                <div class="verbChild">
                @Html.TextBox(attr.AttributeName, stringValue, new { style = "width: 100%" })
                </div>
            }
        </div>
    }
}

@functions
{
    private bool CanDisplayAttribute(string attribute, object value)
    {
        if (!Model.Controller.IsVerbAttribute(attribute)) return false;
        return typeof(string).IsAssignableFrom(value.GetType()) || typeof(IEditableScripts).IsAssignableFrom(value.GetType());
    }
}